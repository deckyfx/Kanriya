@page "/console/brand/page2"
@namespace Kanriya.Server.Blazor.Pages.WebConsole.BrandConsole
@layout BrandLayout
@inject NavigationManager Navigation
@inject BlazorLocalizationService L
@inject AuthenticationStateProvider AuthenticationStateProvider
@using Kanriya.Server.Blazor.Services
@using Microsoft.AspNetCore.Components.Authorization
@attribute [Microsoft.AspNetCore.Authorization.Authorize]

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
        <MudPaper Class="pa-4 mb-4" Elevation="2">
            <MudText Typo="Typo.h4" Class="mb-2">
                Page 2 - Brand Console
            </MudText>
            <MudText Typo="Typo.body1" Color="Color.Secondary" Class="mb-4">
                This is the second page in the brand console area.
            </MudText>
            
            <!-- Navigation buttons -->
            <MudButtonGroup Variant="Variant.Outlined" Color="Color.Primary">
                <MudButton StartIcon="@Icons.Material.Filled.Home" OnClick='() => Navigation.NavigateTo("/console/brand")'>
                    Go to Dashboard
                </MudButton>
                <MudButton StartIcon="@Icons.Material.Filled.Refresh" OnClick="RefreshPage">
                    Refresh Page
                </MudButton>
            </MudButtonGroup>
        </MudPaper>
        
        <MudGrid>
            <MudItem xs="12" md="6">
                <MudCard>
                    <MudCardContent>
                        <MudText Typo="Typo.h6">Brand Information</MudText>
                        <MudText Typo="Typo.body2" Class="mt-2">
                            <strong>Brand ID:</strong> @brandId
                        </MudText>
                        <MudText Typo="Typo.body2">
                            <strong>Brand Name:</strong> @brandName
                        </MudText>
                        <MudText Typo="Typo.body2">
                            <strong>Schema:</strong> @brandSchema
                        </MudText>
                    </MudCardContent>
                </MudCard>
            </MudItem>
            
            <MudItem xs="12" md="6">
                <MudCard>
                    <MudCardContent>
                        <MudText Typo="Typo.h6">Page Status</MudText>
                        <MudText Typo="Typo.body2" Class="mt-2">
                            <strong>Loaded at:</strong> @loadTime.ToString("HH:mm:ss")
                        </MudText>
                        <MudText Typo="Typo.body2">
                            <strong>Brand Context:</strong> Active
                        </MudText>
                        <MudText Typo="Typo.body2">
                            <strong>Page:</strong> /console/brand/page2
                        </MudText>
                    </MudCardContent>
                </MudCard>
            </MudItem>
        </MudGrid>
</MudContainer>

@code {
    private string? brandId;
    private string? brandName;
    private string? brandSchema;
    private DateTime loadTime = DateTime.Now;
    
    protected override async Task OnInitializedAsync()
    {
        L.Initialize();
        
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var tokenType = authState.User.FindFirst("token_type")?.Value;
        
        // Must be brand context
        if (string.IsNullOrEmpty(tokenType) || tokenType != "BRAND")
        {
            // Redirect to main console if not in brand context
            Navigation.NavigateTo("/console");
            return;
        }
        
        brandId = authState.User.FindFirst("brand_id")?.Value;
        brandSchema = authState.User.FindFirst("brand_schema")?.Value;
        brandName = authState.User.FindFirst("brand_name")?.Value ?? "Brand";
    }
    
    private void RefreshPage()
    {
        Navigation.NavigateTo(Navigation.Uri, true);
    }
}